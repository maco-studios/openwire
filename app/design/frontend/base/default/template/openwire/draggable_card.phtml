<?php
$position = $this->getData('position') ?: ['x' => 0, 'y' => 0];
$positionX = $position['x'] ?? 0;
$positionY = $position['y'] ?? 0;
?>
<div ow class="draggable-card"
     @drag="onDragStart"
     style="background-color: <?php echo $this->getColorStyle() ?>; transform: translate(<?php echo $positionX ?>px, <?php echo $positionY ?>px);">

    <div class="card-header">
        <div class="card-title">
            <input type="text"
                   value="<?php echo htmlspecialchars($this->getData('title')) ?>"
                   @change="updateTitle(this.value)"
                   class="title-input" />
        </div>

        <div class="card-actions">
            <select @change="changeColor(this.value)" class="color-select">
                <?php foreach ($this->getAvailableColors() ?: [] as $colorName => $colorValue): ?>
                    <option value="<?php echo $colorName ?>"
                            <?php echo $this->getData('color') === $colorName ? 'selected' : '' ?>
                            style="background-color: <?php echo $colorValue ?>;">
                        <?php echo ucfirst($colorName) ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>
    </div>

    <div class="card-content">
        <textarea @change="updateContent(this.value)"
                  class="content-textarea"
                  placeholder="Enter card content..."><?php echo htmlspecialchars($this->getData('content')) ?></textarea>
    </div>

    <div class="card-footer">
        <div class="card-id">
            ID: <?php echo $this->getData('cardId') ?>
        </div>

        <?php if ($this->getData('price')): ?>
            <div class="card-price">
                Price: $<?php echo number_format($this->getData('price'), 2) ?>
            </div>
        <?php endif; ?>

        <?php if ($this->getData('sku')): ?>
            <div class="card-sku">
                SKU: <?php echo htmlspecialchars($this->getData('sku')) ?>
            </div>
        <?php endif; ?>

        <div class="position-info">
            Position: (<?php echo $positionX ?>, <?php echo $positionY ?>)
        </div>
    </div>

    <div class="drag-handle">
        <span class="drag-icon">⋮⋮</span>
    </div>
</div>

<style>
.draggable-card {
    width: 300px;
    min-height: 200px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    padding: 15px;
    margin: 10px;
    position: relative;
    cursor: move;
    transition: all 0.2s ease;
    color: white;
}

.draggable-card:hover {
    transform: translate(<?php echo $positionX ?>px, <?php echo $positionY - 5 ?>px) !important;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.draggable-card.openwire-dragging {
    opacity: 0.8;
    transform: rotate(5deg) scale(1.05) !important;
    z-index: 1000;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.3);
}

.title-input {
    background: transparent;
    border: none;
    color: white;
    font-size: 18px;
    font-weight: bold;
    width: 100%;
    outline: none;
}

.title-input::placeholder {
    color: rgba(255,255,255,0.7);
}

.color-select {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 4px;
    color: white;
    padding: 5px;
    font-size: 12px;
}

.color-select option {
    background: #333;
    color: white;
}

.card-content {
    flex: 1;
    margin-bottom: 15px;
}

.content-textarea {
    width: 100%;
    min-height: 80px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 4px;
    color: white;
    padding: 10px;
    font-size: 14px;
    resize: vertical;
    outline: none;
}

.content-textarea::placeholder {
    color: rgba(255,255,255,0.7);
}

.card-footer {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    font-size: 12px;
    opacity: 0.8;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.3);
    gap: 3px;
}

.card-price {
    background: rgba(76, 175, 80, 0.8);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 11px;
    font-weight: bold;
}

.card-sku {
    background: rgba(255, 152, 0, 0.8);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
}

.drag-handle {
    position: absolute;
    top: 10px;
    right: 10px;
    opacity: 0.6;
    cursor: move;
}

.drag-icon {
    font-size: 16px;
    font-weight: bold;
    color: rgba(255,255,255,0.8);
}

.draggable-card:hover .drag-handle {
    opacity: 1;
}

/* Color variations */
.draggable-card[style*="rgb(33, 150, 243)"] { /* Blue */
    background: linear-gradient(135deg, #2196F3, #1976D2);
}

.draggable-card[style*="rgb(76, 175, 80)"] { /* Green */
    background: linear-gradient(135deg, #4CAF50, #388E3C);
}

.draggable-card[style*="rgb(255, 152, 0)"] { /* Orange */
    background: linear-gradient(135deg, #FF9800, #F57C00);
}

.draggable-card[style*="rgb(244, 67, 54)"] { /* Red */
    background: linear-gradient(135deg, #F44336, #D32F2F);
}

.draggable-card[style*="rgb(156, 39, 176)"] { /* Purple */
    background: linear-gradient(135deg, #9C27B0, #7B1FA2);
}

.draggable-card[style*="rgb(0, 150, 136)"] { /* Teal */
    background: linear-gradient(135deg, #009688, #00695C);
}
</style>
